commit 552ad0834672fed86ada6430150ef9ebdd3f54d7
Author: Ivan Maidanski <ivmai@mail.ru>
Date:   Tue Sep 27 10:12:18 2016 +0300

    Fix GC_collect_or_expand to prevent allocation size value wrap-around
    
    Relates to issue #135 on Github.
    
    * alloc.c (GC_WORD_MAX): New macro.
    * alloc.c (GC_collect_or_expand): Limit blocks_to_get by
    GC_WORD_MAX / HBLKSIZE value (to avoid multiplication overflow in
    GC_expand_hp_inner).

Index: libgc-7.2d/alloc.c
===================================================================
--- libgc-7.2d.orig/alloc.c	2022-03-29 16:16:27.772284545 +0200
+++ libgc-7.2d/alloc.c	2022-03-29 16:16:27.772284545 +0200
@@ -1221,6 +1221,8 @@
                         /* How many consecutive GC/expansion failures?  */
                         /* Reset by GC_allochblk.                       */
 
+#define GC_WORD_MAX (~(word)0)
+
 /* Collect or expand heap in an attempt make the indicated number of    */
 /* free blocks available.  Should be called until the blocks are        */
 /* available (seting retry value to TRUE unless this is the first call  */
@@ -1269,6 +1271,8 @@
       } else {
         blocks_to_get = MAXHINCR;
       }
+      if (blocks_to_get > divHBLKSZ(GC_WORD_MAX))
+        blocks_to_get = divHBLKSZ(GC_WORD_MAX);
     }
 
     if (!GC_expand_hp_inner(blocks_to_get)
